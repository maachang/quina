<!DOCTYPE HTML SYSTEM "about:legacy-compat">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="robots" content="noindex">
<meta name="description" content="">
<meta name="keywords" content="">
<title>jdbc console</title>

<meta http-equiv="content-type" content="application/xhtml+xml; charset=utf-8"/>
<meta http-equiv="content-style-type" content="text/css; charset=utf-8" />
<meta http-equiv="content-script-type" content="text/javascript; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>

<link rel="stylesheet" href="./console.css" type="text/css">
<script src="./console.js"></script>

<style>
</style>

<script>
(function(_g) {
"use strict";

// Get the DataSource list and generate a SelectBox .
var loadDataSourceList = function() {
    // load login session.
    var header = loadLoginSession();
    if(isNull(header)) {
        // redirect to login page.
        movePage("./login.html");
        return;
    }
    // call ajax.
    ajax("GET",
        "/quina/jdbc/console/getDataSources", null, header,
        function(state, result, responseHeader) {
            var value = parseJSON(result);
            if(isNull(value) || isNull(value = value.value)) {
                // redirect to login page.
                movePage("./login.html");
                return;
            }
            // generate select box.
            createDataSourceSelectBox(value);
        });
}

// generate select box.
var createDataSourceSelectBox = function(list) {
    var sbox = "<select size='1' name='selectDataSource' id='selectDataSource' " +
        "class='base_select' style='width:25%' onchange='javascript:onChangeSelectDataSource(this);'>";
    sbox += "\n<option value='' hidden>* Select the DataSource to connect to</option>";
    var len = list.length;
    var beforeSelect = getBefoerSelectDataSource();
    for(var i = 0; i < len; i ++) {
        sbox += "\n<option value='" + list[i] + "'";
        if(beforeSelect != null && beforeSelect == list[i]) {
            sbox += " selected";
        }
        sbox += ">" + list[i] + "</option>";
    }
    sbox += "</select>";
    document.getElementById("dataSourceList").innerHTML = sbox;
}

// 選択したDataSource名を記録.
var onChangeSelectDataSource = function(e) {
    var idx = e.selectedIndex;
    var value = e.options[idx].value;
    // The new dataSource has changed.
    localStorage.setItem("selectDataSource", value);
}

// 前回選択したDataSource名を取得.
var getBefoerSelectDataSource = function() {
    var ret = localStorage.getItem("selectDataSource");
    if(isNull(ret)) {
        return null;
    }
    return ret;
}

_g.loadDataSourceList = loadDataSourceList;
_g.onChangeSelectDataSource = onChangeSelectDataSource;

})(this);
</script>

</head>
<body onload="javascript:loadDataSourceList();">
    <div id="pageId">
        <div style="position:absolute;left:2%;top:1%;width:96%;">

            <div id="dataSourceList">
                <select size='1' name='selectDataSource' id='selectDataSource'
                    class='base_select' style='width:25%'>
                    <option value='' hidden>* Select the DataSource to connect to</option>
                </select>
            </div>



        </div>
    </div>
</body>

