<!DOCTYPE HTML SYSTEM "about:legacy-compat">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="robots" content="noindex">
<meta name="description" content="">
<meta name="keywords" content="">
<title>jdbc console</title>

<meta http-equiv="content-type" content="application/xhtml+xml; charset=utf-8"/>
<meta http-equiv="content-style-type" content="text/css; charset=utf-8" />
<meta http-equiv="content-script-type" content="text/javascript; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>

<link rel="stylesheet" href="./console.css" type="text/css">
<script src="./console.js"></script>

<style>
</style>

<script>
(function(_g) {
"use strict";

// 64 signetuer code.
var signetuerCode = "+/abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";
// create signetuer.
var createSignetuer = function(len) {
    if(isNull(len)) {
        len = 48;
    }
    var rand = new Xor128();
    var ret = "";
    for(var i = 0; i < len; i ++) {
        ret += signetuerCode.charAt(rand.next() & 0x03f);
    }
    return ret;
}

// errorMessage.
var setErrorMessage = function(msg) {
    if(isNull(msg) || (msg = "" + msg.trim()).length == 0) {
        msg = "";
    }
    var e = document.getElementById("errorMessage");
    e.innerHTML = msg;
}

// clear login input.
var clearLogin = function() {
    setErrorMessage("");
    document.getElementById("user").value = "";
    document.getElementById("password").value = "";
}

// action login.
var loginAction = function() {
    setErrorMessage("");
    var user = document.getElementById("user").value;
    var password = document.getElementById("password").value;
    // Exception if user name is not set. 
    if(isNull(user) ||
        (user = "" + user.trim()).length == 0) {
        setErrorMessage("The user name has not been set.");
        return false;
    }
    // If no password is set, set empty.
    if(isNull(password)) {
        password = "";
    }
    // Generate a signature.
    var signetureCode = createSignetuer();
    // auth login.
    ajax("GET",
        "/quina/jdbc/console/" + user + "/" + password + "/login",
        null, {"X-Jdbc-Console-Signeture": signetureCode},
        function(state, result, responseHeader) {
            var value = parseJSON(result);
            if(isNull(value)) {
                // login error.
                setErrorMessage("Failed to login to the jdbc console.");
                return;
            }
            // success login.
            if(state == 200) {
                // save login session.
                saveLoginSession(signetureCode, responseHeader);
                // success login next page.
                movePage("./console.html")
            } else {
                // login error.
                setErrorMessage(value.message);
            }
        });
}

_g.createSignetuer = createSignetuer;
_g.setErrorMessage = setErrorMessage;
_g.loginAction = loginAction;
_g.clearLogin = clearLogin;

})(this);
</script>

</head>
<body>
    <div id="pageId">
        <div style="position:absolute;left:4%;top:5%;width:94%;">
            <div style="font-weight:bold;font-size:24px;" >
                JDBC - console login
            </div>
            <br>
            <div id="errorMessage" style="color:#7f0000"></div>
            <div style="width:60%">
                <div style="font-weight:bold;" >user name</div>
                <input type="user" name="user" id="user" class="base_input_text" style="margin-left:10px;width:70%;ime-mode:disabled;"
                    placeholder="user name">
            </div>
            <div style="width:60%">
                <div style="font-weight:bold;" >password</div>
                <input type="password" name="password" id="password" class="base_input_text" style="margin-left:10px;width:70%;ime-mode:disabled;"
                    placeholder="password">
            </div>
            
            <div style="margin-top:15px">
                <a href="javascript:void(0);" class="base_button" onclick="javascript:loginAction();">login</a>
                &nbsp;
                <a href="javascript:void(0);" class="base_button" onclick="javascript:clearLogin();">clear</a>
            </div>
        </div>
    </div>
</body>
</html>

